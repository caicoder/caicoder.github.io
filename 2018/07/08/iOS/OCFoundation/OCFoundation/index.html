<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="OC,">










<meta name="description" content="OC 语言特性 OC 基础知识 1. 成员变量 实例变量 属性  图中的Member Variable declarations翻译过来就是成员变量的声明 1234567类： Class (description/template for an object)实例： Instance (manifestation of a class)消息： Message (sent to object to">
<meta name="keywords" content="OC">
<meta property="og:type" content="article">
<meta property="og:title" content="OC 语言特性">
<meta property="og:url" content="https://caicoder.github.io/2018/07/08/iOS/OCFoundation/OCFoundation/index.html">
<meta property="og:site_name" content="caicoder的博客">
<meta property="og:description" content="OC 语言特性 OC 基础知识 1. 成员变量 实例变量 属性  图中的Member Variable declarations翻译过来就是成员变量的声明 1234567类： Class (description/template for an object)实例： Instance (manifestation of a class)消息： Message (sent to object to">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://sylarimage.oss-cn-shenzhen.aliyuncs.com/2019-03-19-014905.png">
<meta property="og:image" content="http://sylarimage.oss-cn-shenzhen.aliyuncs.com/2019-03-14-095543.jpg">
<meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318144225.png">
<meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318144307.png">
<meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318144554.png">
<meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318144841.png">
<meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318150641.png">
<meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/MRC%E3%80%81ARCBlock%E5%85%B3%E9%94%AE%E5%AD%97.png">
<meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318154344.png">
<meta property="og:image" content="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318154359.png">
<meta property="og:updated_time" content="2019-04-16T06:17:07.679Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OC 语言特性">
<meta name="twitter:description" content="OC 语言特性 OC 基础知识 1. 成员变量 实例变量 属性  图中的Member Variable declarations翻译过来就是成员变量的声明 1234567类： Class (description/template for an object)实例： Instance (manifestation of a class)消息： Message (sent to object to">
<meta name="twitter:image" content="http://sylarimage.oss-cn-shenzhen.aliyuncs.com/2019-03-19-014905.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://caicoder.github.io/2018/07/08/iOS/OCFoundation/OCFoundation/">





  <title>OC 语言特性 | caicoder的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">caicoder的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://caicoder.github.io/2018/07/08/iOS/OCFoundation/OCFoundation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="caicoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="caicoder的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">OC 语言特性</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-08T12:12:42+08:00">
                2018-07-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1>OC 语言特性</h1>
<h2>OC 基础知识</h2>
<h3>1. 成员变量 实例变量 属性</h3>
<p><img src="http://sylarimage.oss-cn-shenzhen.aliyuncs.com/2019-03-19-014905.png" alt="image-20190313113006579"></p>
<p>图中的<strong>Member Variable declarations</strong>翻译过来就是<strong>成员变量的声明</strong></p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">类： Class (description/template for an object)</span><br><span class="line">实例： Instance (manifestation of a class)</span><br><span class="line">消息： Message (sent to object to make it act)</span><br><span class="line">方法： Method (code invoked by a Message)</span><br><span class="line">实例变量： Instance Variable (object-specific storage)</span><br><span class="line">超类/子类： Superclass/Subclass (Inheritance)</span><br><span class="line">协议：  Protocol (non-class-specific methods)</span><br></pre></td></tr></table></figure></p>
<p>从给出的英文说明，可以看出：实例（Instance）是针对 类（class）而言的。实例是指类的声明；由此推理，实例变量（Instance Variable） 是指<strong>由类声明的对象</strong>。</p>
<p>严格说来，上图中的  int  count;  是一个成员变量。</p>
<p>而 <code>NSString name；</code> 是一个实例变量（NSString是一个类）。</p>
<p>至于 id data 应该属于成员变量还是实例变量呢？  因为 id 是 OC特有的类型。从本质上讲， id 等同于 （void *）。 所以 id data 应属于 实例变量。</p>
<p><strong>成员变量</strong>：通常是指向对象或是基础类型（int, float）的简单指针。可以在.h 或是 .m 文件中声明：</p>
<p><strong>实例变量</strong>：是成员变量的一种，实例是针对类而言的，是指对类的声明；由此推理，实例变量是指由类声明的对象。</p>
<p><strong>属性</strong>：GCC 到 LLVM（low level virtual machine），编译器自动为属性添加成员变量，规则：_属性名。如果需要自定义成员变量的名字，可以使用@synthesizer实现。</p>
<h3>2.分类</h3>
<h4>2.1 特点</h4>
<ul>
<li>运行时决议 --- 比如一个数组类，在编好分类文件之后，并没有把分类当中对应添加的内容附加到相应的数组类，而是在运行时通过 runtime 真实的添加到数组类中</li>
<li>可以为系统类添加分类</li>
</ul>
<h4>2.2分类都做了哪些事</h4>
<ul>
<li>声明私有方法</li>
<li>分解体积庞大的类文件</li>
<li>把 Framework 的私有方法公开</li>
</ul>
<h4>2.3 分类中都可以添加哪些内容</h4>
<ul>
<li>实例方法</li>
<li>类方法</li>
<li>协议</li>
<li>属性(不是添加实例变量，实例变量需要通过关联对象添加)</li>
</ul>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">typedef struct category_t &#123;</span><br><span class="line">    const char *name;</span><br><span class="line">    classref_t cls;</span><br><span class="line">    struct method_list_t *instanceMethods; //实例方法列表</span><br><span class="line">    struct method_list_t *classMethods;</span><br><span class="line">    struct protocol_list_t *protocols;</span><br><span class="line">    struct property_list_t *instanceProperties;</span><br><span class="line">&#125; category_t;</span><br></pre></td></tr></table></figure></p>
<h4>2.4 加载调用栈</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_objc_init</span><br><span class="line">└──map_2_images</span><br><span class="line">    └──map_images_nolock</span><br><span class="line">        └──_read_images</span><br><span class="line">            └──_remethodizeClass</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>_objc_init</code> 算是整个 objc 的入口，进行了一些初始化操作，注册了镜像状态改变时的回调函数</li>
<li><code>map_2_images</code> 主要是加锁并调用 <code>map_images_nolock</code> ，加载内存镜像相关内容</li>
<li><code>map_images_nolock</code> 在这个函数中，完成所有 class 的注册、fixup等工作，还有初始化自动释放池、初始化 side table 等工作并在函数后端调用了 <code>_read_images</code></li>
<li><code>_read_images</code> 方法干了很多苦力活，比如加载类、Protocol、Category，加载分类的代码就写在 <code>_read_images</code> 函数的尾部</li>
</ul>
<p>分类被附加到类上是在map_images的时候发生的。</p>
<p>首先拿到<code>category_t</code>数组 (获得所有<code>Category</code>文件)</p>
<ol>
<li>把category的实例方法、协议以及属性添加到类上</li>
<li>把category的类方法和协议添加到类的metaclass上</li>
</ol>
<p>把所有<code>category</code>的实例方法列表拼成了一个<code>大的实例方法列表</code>，然后转交给了attachMethodLists方法(方法，扩展也类似)</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">for (uint32_t m = 0;</span><br><span class="line">             (scanForCustomRR || scanForCustomAWZ)  &amp;&amp;  m &lt; mlist-&gt;count;</span><br><span class="line">             m++)</span><br><span class="line">        &#123;</span><br><span class="line">            SEL sel = method_list_nth(mlist, m)-&gt;name;</span><br><span class="line">            if (scanForCustomRR  &amp;&amp;  isRRSelector(sel)) &#123;</span><br><span class="line">                cls-&gt;setHasCustomRR();</span><br><span class="line">                scanForCustomRR = false;</span><br><span class="line">            &#125; else if (scanForCustomAWZ  &amp;&amp;  isAWZSelector(sel)) &#123;</span><br><span class="line">                cls-&gt;setHasCustomAWZ();</span><br><span class="line">                scanForCustomAWZ = false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Fill method list array</span><br><span class="line">        newLists[newCount++] = mlist;</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line"></span><br><span class="line">    // Copy old methods to the method list array</span><br><span class="line">    for (i = 0; i &lt; oldCount; i++) &#123;</span><br><span class="line">        newLists[newCount++] = oldLists[i];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>所谓的方法覆盖，原有的方法并没有消失，只是他在方法列表中的索引后于分类中的方法。而运行时方法查找是顺着方法列表顺序查找的。所以如果要调原方法也很简单，顺着方法列表找到最后一个对应名字的方法就是原方法。</p>
<p>以分类方法为例，类中的方法数组是一个二维数组，结构如下:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//二维数组</span><br><span class="line">[[method_t,method_t],[method_t],[method_t,method_t],...];</span><br><span class="line"></span><br><span class="line">//外围中括号指的是类方法列表数组</span><br><span class="line">//内部多个中括号只分类中的Method方法合并到类中的数组</span><br><span class="line">//代理等也是这个数据结构</span><br></pre></td></tr></table></figure></p>
<h4>2.5  Category 和 +load</h4>
<ol>
<li>在类的+load方法调用的时候，我们可以调用category中声明的方法么？</li>
</ol>
<p>可以调用，因为附加category到类的工作会先于+load方法的执行(指&quot;替换&quot;原类方法)</p>
<ol start="2">
<li>这么些个+load方法，调用顺序是咋样的呢？</li>
</ol>
<p>+load的执行顺序是先类，后category，而category的+load执行顺序是根据编译顺序决定的。</p>
<ul>
<li>load方法的调用顺序有两条规则:父类先于子类调用，类先于分类调用。</li>
<li>那么，在多个分类的情况下呢？取决于编译器中的compile sources中的顺序。而后编译的，在&quot;同名覆盖&quot;的情况下，方法会先被找到。</li>
</ul>
<h4>2.5 总结</h4>
<p>（1）分类添加的办法可以“覆盖”原类办法，实则各个类别的办法依然存在办法列表中。也就是说如果category和原来类都有methodA，那么category附加完成之后，类的方法列表里会有两个methodA。<strong>category的方法被放到了新方法列表的前面，而原来类的方法被放到了新方法列表的后面</strong></p>
<p>（2）同名分类办法谁能生效取决于编译顺序</p>
<p>（3）名字相同的分类会引起编译报错</p>
<h3>3. 关联对象</h3>
<h4>3.1 意义</h4>
<p>顾名思义，就是把一个对象关联到另外一个对象身上。使两者能够产生联系。</p>
<p>使用场景:</p>
<ul>
<li>运行时给cagetory添加getter和setter。因为category中添加的property不会生成带下划线&quot;_&quot;的成员变量以及getter和setter的实现。所以可以通过关联对象实现getter和setter。<strong>(主要)</strong></li>
<li>有时需要在对象中存储一些额外的信息，我们通常会从对象所属的类中继承一个子类。然后给这个子类添加额外的属性，改用这个子类。然而并非所有的情况都能这么做，有时候类的实例可能是由某种机制创建的，而开发者无法另这种机制创建出自己所写的子类实例。此时可以使用“关联对象”。</li>
<li>有时只是给某个类添加一个额外的属性，完全没有必要继承出来一个子类。此时可以使用“关联对象”。</li>
<li>delegate回调的方法中使用关联对象。有时候在一些delegate回调的方法中需要处理一些回调任务。比如发起网络请求和在delegate回调的方法中做UI的更新。这样一来，发起网络请求和在回调中更新UI的代码被分散到了两个地方，不利于管理和阅读。此时可以使用“关联对象”。</li>
</ul>
<h4>3.2 重要函数</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id objc_getAssociatedObject(id object , const void *key)</span><br><span class="line"></span><br><span class="line">void objc_setAssociatedObject(id object,const void *key,id value, objc_AssociationPolicy policy)</span><br><span class="line"></span><br><span class="line">void objc_removeAssociatedObject(id object)</span><br></pre></td></tr></table></figure></p>
<h4>3.3 关联对象本质</h4>
<ul>
<li>关联对象由 <code>AssociationsManager</code> 管理并在 <code>AssiciationsHashMap</code> 存储。</li>
<li>所有对象的关联内容都在同一个全局容器中。</li>
</ul>
<p><img src="http://sylarimage.oss-cn-shenzhen.aliyuncs.com/2019-03-14-095543.jpg" alt></p>
<ul>
<li>关联对象的释放时机与移除时机并不总是一致，比如实验中用关联策略 <strong>OBJC_ASSOCIATION_ASSIGN</strong> 进行<strong>关联的对象</strong>，很早就已经被释放了，但是并没有被移除，而再使用这个关联对象时就会造成 Crash 。[注意是用Assign关联对象(@property中用assign也会导致崩溃)]</li>
</ul>
<h3>3. 扩展</h3>
<blockquote>
<p>A class extension bears some similarity to a category, <strong>but it can only be added to a class for which you have the source code</strong> at compile time (the class is compiled at the same time as the class extension). The methods declared by a class extension are implemented in the <code>@implementation</code> block for the original class so you can’t, for example, declare a class extension on a framework class, such as a Cocoa or Cocoa Touch class like <code>NSString</code>.</p>
<p>//引用自苹果</p>
<p>//重点核心意思:与分类相似，但是只能被添加到有源码的类文件中</p>
</blockquote>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//implementation file (.m) </span><br><span class="line">//.m文件中实现</span><br><span class="line">@interface ClassName ()</span><br><span class="line"> </span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>一般用扩展做什么</p>
<ul>
<li>声明私有属性</li>
<li>声明私有方法</li>
<li>声明私有成员变量</li>
</ul>
<p>扩展的特点 (和分类的区别)</p>
<ul>
<li>编译时决议(内存结构规定后无法修改)</li>
<li>只以声明的形式存在，多数情况下寄生于宿主类的.m中(即需要源码)</li>
<li>不能为系统类添加扩展</li>
</ul>
<h3>4.代理</h3>
<ul>
<li>准确的说是一种软件设计模式</li>
<li>iOS当中以@protocol形式体现</li>
<li>传递方式一对一</li>
<li>一般声明为weak以规避循环引用</li>
</ul>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318144225.png" alt></p>
<p>代理方:主动</p>
<p>委托方:被动</p>
<p>代理的实现流程:</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318144307.png" alt></p>
<h3>5.通知</h3>
<ul>
<li>是使用<strong>观察者模式</strong>来实现用于跨层传递消息的机制</li>
<li>传递方式为一对多</li>
</ul>
<p>如何实现通知机制？（没有源代码）</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318144554.png" alt></p>
<h3>6.KVO</h3>
<p><strong>Q:什么是KVO？</strong></p>
<p><strong>A:</strong> OC 对观察者模式的又一实现； Apple 使用了 <strong>isa 混写</strong>(isa-swizzling) 来实现KVO.</p>
<ul>
<li>
<p>KVO是基于runtime机制实现的</p>
</li>
<li>
<p>当某个类的属性对象<code>第一次被观察</code>时，系统就会在运行期动态地创建该类的一个派生类，在这个派生类中重写基类中任何被观察属性的setter 方法。派生类在被重写的setter方法内实现真正的<code>通知机制</code></p>
</li>
<li>
<p>每个类对象中都有一个isa指针指向当前类，当一个类对象的第一次被观察，那么系统会偷偷将isa指针指向动态生成的派生类，从而在给被监控属性赋值时执行的是派生类的setter方法</p>
</li>
<li>
<p>KVO的这套实现机制中苹果还偷偷重写了class方法，让我们误认为还是使用的当前类，从而达到隐藏生成的派生类</p>
</li>
</ul>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318144841.png" alt></p>
<p>当调用了 <code>addObserver:forkeypath</code>方法之后，系统会动态创建 <code>NSKVONorifying_A</code>类，同时将A的isa指针指向 NSKVONorifying_A。</p>
<p>iOS中<code>KVO</code>分为自动监听和手动触发两种形式</p>
<p>手动触发:</p>
<ol>
<li>重写监听属性的set、get方法</li>
<li>重写 <code>+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)key</code></li>
<li>在set方法中在赋值的前后分别调用：<code>willChangeValueForKey</code>和<code>didChangeValueForKey</code></li>
<li>实现<code>willChangeValueForKey</code>和<code>didChangeValueForKey</code>方法</li>
</ol>
<p>其中需要重写</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)key&#123;</span><br><span class="line">  if([key isEqualToString:@&quot;age&quot;])&#123;</span><br><span class="line">  //取消自动发送通知</span><br><span class="line">    return NO;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    return [super automaticallyNotifiesObserversForKey:key];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>7.KVC</h3>
<p>是一种键值对设计模式，破坏面对对象的编程思想。(不重写特定方法,找不到Key情况下会崩溃)</p>
<p>主要方法</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-(id)valueForKey:(NSString *)key</span><br><span class="line">-(void)setValue:(id)value forked:(NSString *)key;</span><br></pre></td></tr></table></figure></p>
<p>寻找路径</p>
<p><code>setterKey(keySet方法)</code> -&gt; <code>_key</code> -&gt; <code>_isKey</code> -&gt; <code>key</code> -&gt; <code>iskey</code></p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318150641.png" alt></p>
<h2></h2>
<p><strong>KVC setvalue:forkey与setvalue:forkeypath的区别</strong>:</p>
<p><code>forkey</code>用于简单路径,<code>forkeypath</code>用于复合路径(比如key是对象，可以直接赋值给这个对象的属性.eg:<code>setValue:@100 forKeyPath:@&quot;person.number&quot;</code>)</p>
<h3>8.属性关键字</h3>
<p>读写权限</p>
<ul>
<li>readonly</li>
<li>readwrite      √默认关键字</li>
</ul>
<p>引用计数</p>
<ul>
<li>
<p>retain / strong</p>
</li>
<li>
<p>weak / assign</p>
<p>assign:</p>
<p>修饰基本数据类型，如int, bool等</p>
<p>修饰对象类型时，不改变其引用计数</p>
<p>会产生悬垂指针：仍然指向内存地址，如果没覆盖后还调动变量就会crash</p>
<p>weak：</p>
<p>不改变修饰对象的引用计数</p>
<p>所指对象在释放之后会自动设置为nil</p>
</li>
<li>
<p>copy</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>name</th>
<th>浅拷贝</th>
<th>深拷贝</th>
</tr>
</thead>
<tbody>
<tr>
<td>新内存空间</td>
<td>不分配</td>
<td>分配</td>
</tr>
<tr>
<td>引用计数</td>
<td>影响</td>
<td>不影响</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>源对象类型</th>
<th>拷贝方式</th>
<th>目标对象类型</th>
<th>拷贝类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>mutable对象</td>
<td>copy</td>
<td>不可变</td>
<td>深拷贝</td>
</tr>
<tr>
<td>mutable对象</td>
<td>mutableCopy</td>
<td>可变</td>
<td>深拷贝</td>
</tr>
<tr>
<td>immutable对象</td>
<td>copy</td>
<td>不可变</td>
<td>浅拷贝</td>
</tr>
<tr>
<td>immutable对象</td>
<td>mutableCopy</td>
<td>可变</td>
<td>深拷贝</td>
</tr>
</tbody>
</table>
<p>原子性</p>
<ul>
<li>atomic     √默认关键字</li>
<li>nonatomic</li>
</ul>
<p>atomic<code>保证赋值获取是线程安全,是对成员属性的直接的获取安全，并不代表操作和访问安全.</code>
比如 <code>atomic</code> 修饰的是一个数组,对数组<strong>赋值获取</strong>是安全的，但是对数组<strong>进行操作</strong>(添加对象，移除对象)是不保证线程不安全的.而且采用<code>atomic</code>消耗比较大</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">array = [[NSArray alloc]init];	//安全</span><br><span class="line">[array addobject:obj];	//也会存在不安全</span><br></pre></td></tr></table></figure></p>
<h3>9.常见问题</h3>
<h4>1.retain和strong</h4>
<p>都是强引用，除了某些情况下不一样，比如修饰block，其他的时候也是可以通用的。</p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/MRC%E3%80%81ARCBlock%E5%85%B3%E9%94%AE%E5%AD%97.png" alt></p>
<h4>2.深拷贝浅拷贝</h4>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318154344.png" alt></p>
<p><img src="https://sylarimage.oss-cn-shenzhen.aliyuncs.com/20190318154359.png" alt></p>
<h4>3.copy返回的都是不可变对象</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//提问， 这样写有什么问题 ?</span><br><span class="line">@property(copy)NSMutableArray *array?</span><br></pre></td></tr></table></figure></p>
<p>无论复制过来的是可变还是不可变对象，都是NSArray，当调用方调用 Array 的添加对象和移除对象等操作，对于不可变 Array 就会产生程序异常</p>
<h2>Reference</h2>
<p><a href="https://juejin.im/post/5c753bc251882505d52fba5c" target="_blank" rel="noopener">1. 面试驱动技术 - Category 相关考点(Article文件夹有收藏)</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/OC/" rel="tag"># OC</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/07/iOS/Autoreleasepool/Autoreleasepool/" rel="next" title="Autoreleasepool">
                <i class="fa fa-chevron-left"></i> Autoreleasepool
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/08/iOS/Runloop/Runloop/" rel="prev" title="Runloop">
                Runloop <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">caicoder</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">43</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">OC 语言特性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.</span> <span class="nav-text">OC 基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.1.</span> <span class="nav-text">1. 成员变量 实例变量 属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.2.</span> <span class="nav-text">2.分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">2.1 特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">2.2分类都做了哪些事</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">2.3 分类中都可以添加哪些内容</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">2.4 加载调用栈</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.2.5.</span> <span class="nav-text">2.5  Category 和 +load</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.2.6.</span> <span class="nav-text">2.5 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.3.</span> <span class="nav-text">3. 关联对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">3.1 意义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">3.2 重要函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">3.3 关联对象本质</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.4.</span> <span class="nav-text">3. 扩展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.5.</span> <span class="nav-text">4.代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.6.</span> <span class="nav-text">5.通知</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.7.</span> <span class="nav-text">6.KVO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.1.8.</span> <span class="nav-text">7.KVC</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">1.2.</span> <span class="nav-text"></span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.2.1.</span> <span class="nav-text">8.属性关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-number">1.2.2.</span> <span class="nav-text">9.常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">1.retain和strong</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">2.深拷贝浅拷贝</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#undefined"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">3.copy返回的都是不可变对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">1.3.</span> <span class="nav-text">Reference</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">caicoder</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
